<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Buying Example</title>
    <script src="/javascripts/jquery-1.12.1.min.js"> </script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
    <script src="/stylesheets/bootstrap/js/bootstrap.min.js"></script>
</head>

<body>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="">ROMAPLZ</a>
        </div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Browse
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#">Cat</a></li>
                    <li><a href="#">Dog</a></li>
                    <li><a href="#">Potato</a></li>
                </ul>
            </li>
            <li class="active"><a href="/">Sell</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-shopping-cart"></span> View Cart <span class="badge">5</span></a></li>
            <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
        </ul>
    </div>
</nav>

<div class="container">
    <h2 id = "title"></h2>

    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <!-- Left and right controls -->
        <ol id="carouselIndicators" class="carousel-indicators"> </ol>

        <!-- Wrapper for slides -->

        <div id = "carouselInner" class="carousel-inner" role="listbox"></div>

        <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>

    <div class="well">
        <div class="text-center">
            <button id="cart" type="button" onclick="addToCart()" class="btn btn-warning">Add to Cart <span class="glyphicon glyphicon-shopping-cart"></span></button>

            <div id="success" class="alert alert-success" style="display:none"/>
        </div>

        <div class="text-left">
            <h3>Item Description: </h3>
            <p id = "desc">a description here</p>

        </div>
    </div>

</div>
</body>
<script>
    //var item;

    getItem();
    function getItem(){
        //item = {title:"ECS", desc: "A great deal of disappointment",price: 77,images:["/images/uploads/19574e1c2d3aea60ae72a43a6e016491.png","/images/uploads/1c8f360e53886b6e6f0352ea3d38a156.png"]};

        $.ajax({
            url: "/buy/item",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({itemID:getParameterByName("id")}),
            success: function(response){
                console.log("RES: " + response);
                response = JSON.parse(response);
                response.image = JSON.parse(response.image);
                console.log(response.title);
                console.log(response.price);
                console.log(response.image);
                displayItem(response);
            }
        });
    }

    function displayItem(item){
        $("#title").html(item.name+' <small>'+item.price+'</small>');
        $("#desc").text(item.description);
        var indicators = "";
        var inner = "";
        for (i in item.image){
            if (i == 0){
                indicators+= '<li data-target="#myCarousel" data-slide-to="'+i+'" class="active"></li>';
                inner+= '<div class="item active">';
            }
            else {
                indicators+= '<li data-target="#myCarousel" data-slide-to="'+i+'"></li>';
                inner+= '<div class="item">';
            }

            inner+= '<div class="slider-size">' +
                    '<img src="'+item.image[i]+'" style="height: 100%;"/> ' +
                    '</div> ' +
                    '</div>';
        }
        $("#carouselIndicators").html(indicators);
        $("#carouselInner").html(inner);
    }

    function addToCart(){
        var out = {};
        $.ajax({
            url: "/buy/addToCart",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(out),
            success: function(response){
                $("#cart").addClass("disabled");
                $("#success").html(response);
                $("#success").show(300);
            }
        });
    }

    function getParameterByName(name) {
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
        if (!results) return '';
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
</script>
</html>